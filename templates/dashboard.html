{% extends 'base.html' %}

{% block title %}Dashboard - ParentPlanner{% endblock %}

{% block extra_head %}
<!-- Dashboard-specific JavaScript -->
{% load static %}
<script src="{% static 'js/dashboard.js' %}"></script>
<style>
/* Custom breakpoints for large screens with responsive font scaling */
/* 1440px+ screens get the 3-column layout */
@media (min-width: 1440px) {
    .ultra-wide-grid {
        display: grid !important;
        grid-template-columns: 320px 1fr 360px !important; /* Left column (children), Middle (timeline), Right (notes) */
        gap: 1.25rem !important;
        flex-direction: unset !important; /* Override flex properties */
    }
    .ultra-wide-notes {
        display: block !important;
    }
    /* Override the flex child properties for grid layout */
    .ultra-wide-grid > div {
        width: auto !important;
        flex-shrink: unset !important;
        flex: unset !important;
    }
    
    /* Responsive font scaling for 1440px+ */
    .responsive-text-sm { font-size: 0.875rem; }
    .responsive-text-base { font-size: 1rem; }
    .responsive-text-lg { font-size: 1.125rem; }
    .responsive-text-xl { font-size: 1.25rem; }
    .responsive-text-2xl { font-size: 1.5rem; }
}

/* 1600px+ screens get slightly larger fonts */
@media (min-width: 1600px) {
    .ultra-wide-grid {
        grid-template-columns: 360px 1fr 400px !important;
        gap: 1.5rem !important;
    }
    
    .responsive-text-sm { font-size: 0.9375rem; }
    .responsive-text-base { font-size: 1.0625rem; }
    .responsive-text-lg { font-size: 1.1875rem; }
    .responsive-text-xl { font-size: 1.3125rem; }
    .responsive-text-2xl { font-size: 1.5625rem; }
}

/* 1920px+ screens get even larger fonts */
@media (min-width: 1920px) {
    .ultra-wide-grid {
        grid-template-columns: 400px 1fr 440px !important;
        gap: 1.75rem !important;
    }
    
    .responsive-text-sm { font-size: 1rem; }
    .responsive-text-base { font-size: 1.125rem; }
    .responsive-text-lg { font-size: 1.25rem; }
    .responsive-text-xl { font-size: 1.375rem; }
    .responsive-text-2xl { font-size: 1.625rem; }
}

/* 2560px+ screens get maximum fonts */
@media (min-width: 2560px) {
    .ultra-wide-grid {
        grid-template-columns: 480px 1fr 520px !important;
        gap: 2rem !important;
    }
    
    .responsive-text-sm { font-size: 1.0625rem; }
    .responsive-text-base { font-size: 1.1875rem; }
    .responsive-text-lg { font-size: 1.3125rem; }
    .responsive-text-xl { font-size: 1.4375rem; }
    .responsive-text-2xl { font-size: 1.75rem; }
}
</style>
<script>
    // Override any external dashboard.js functions to match child page exactly
    console.log('Dashboard template: Overriding external functions to match child page behavior');
    
    // Force override the external function with child page matching behavior
    window.toggleEntryType = function(type) {
        console.log('Child page matching toggleEntryType called with:', type);
        
        // Update button states to match child page exactly
        const buttons = ['filter-all', 'filter-task', 'filter-event'];
        buttons.forEach(id => {
            const btn = document.getElementById(id);
            if (btn) {
                // Reset to inactive state with proper hover classes (matching child page)
                if (id === 'filter-all') {
                    btn.className = 'py-2 px-4 border-2 font-normal text-sm tracking-wide transition-all duration-200 bg-white text-gray-700 border-gray-300 hover:border-primary hover:text-primary';
                } else if (id === 'filter-task') {
                    btn.className = 'py-2 px-4 border-2 font-normal text-sm tracking-wide transition-all duration-200 bg-white text-gray-700 border-gray-300 hover:border-amber-600 hover:text-amber-600';
                } else if (id === 'filter-event') {
                    btn.className = 'py-2 px-4 border-2 font-normal text-sm tracking-wide transition-all duration-200 bg-white text-gray-700 border-gray-300 hover:border-violet-600 hover:text-violet-600';
                }
                
                // Set active state for selected button (no hover classes when active - matching child page)
                if (id === 'filter-' + type) {
                    if (type === 'all') {
                        btn.className = 'py-2 px-4 border-2 font-normal text-sm tracking-wide transition-all duration-200 bg-primary text-white border-primary';
                    } else if (type === 'task') {
                        btn.className = 'py-2 px-4 border-2 font-normal text-sm tracking-wide transition-all duration-200 bg-amber-600 text-white border-amber-600';
                    } else if (type === 'event') {
                        btn.className = 'py-2 px-4 border-2 font-normal text-sm tracking-wide transition-all duration-200 bg-violet-600 text-white border-violet-600';
                    }
                }
            }
        });
        
        // Filter entries (matching child page logic)
        const entries = document.querySelectorAll('.entry-card');
        entries.forEach(entry => {
            const entryType = entry.getAttribute('data-entry-type');
            if (type === 'all' || entryType === type) {
                entry.style.display = 'block';
            } else {
                entry.style.display = 'none';
            }
        });
    };
    
    console.log('Dashboard template: Child page matching functions loaded successfully');
</script>
<style>
    /* Simple entry card styling */
    .entry-card {
        transition: all 0.2s ease;
    }

    .entry-card:hover {
        transform: translateY(-1px);
    }
</style>
{% endblock %}

{% block content %}
<div class="px-3 sm:px-6 py-4 sm:py-6 overflow-hidden h-screen">
<!-- Message System -->
{% if messages %}
<div class="mb-3 sm:mb-6">
    {% for message in messages %}
    {# Filter out unwanted allauth messages #}
    {% if "Successfully signed in" not in message|stringformat:"s" and "You have signed out" not in message|stringformat:"s" %}
    <div
        class="border-l-4 p-2 sm:p-4 mb-2 sm:mb-4 text-sm sm:text-base {% if message.tags == 'success' %}bg-green-50 border-green-500 text-green-800{% elif message.tags == 'error' %}bg-red-50 border-red-500 text-red-800{% else %}bg-blue-50 border-blue-500 text-blue-800{% endif %}">
        <div class="flex items-center">
            <span class="font-medium">{{ message }}</span>
        </div>
    </div>
    {% endif %}
    {% endfor %}
</div>
{% endif %}

<!-- Two-Column Layout for Tablets, Three-Column for Ultra-Wide (2560px+) -->
<div class="flex flex-col md:flex-row gap-4 md:gap-6 md:h-[calc(100vh-140px)] overflow-hidden ultra-wide-grid">
    <!-- Left Column: Your Children Section - Fixed optimal width -->
    <div class="w-full md:w-80 lg:w-96 md:flex-shrink-0 overflow-hidden">
        <!-- Modern Family Management Section -->
        <div class="bg-white border-2 border-primary shadow-lg mb-4 md:mb-0 md:h-full md:overflow-y-auto">
    <!-- Family Management Header -->
    <div class="border-b-2 border-primary bg-gray-50 px-3 py-2 sm:px-6 sm:py-4">
        <div class="flex justify-between items-center">
            <div>
                <h2 class="text-lg sm:text-xl md:text-2xl lg:text-3xl responsive-text-2xl font-normal text-gray-900 tracking-wide">Your Children</h2>
            </div>
            <div class="border-l-2 border-primary pl-3 sm:pl-4 flex items-center justify-center">
                <a href="{% url 'add_child' %}"
                    class="bg-primary hover:bg-secondary text-white font-normal px-3 py-2 sm:px-4 sm:py-3 border-2 border-primary transition-all duration-200 tracking-wide text-xs sm:text-sm hover:shadow-lg flex items-center justify-center"
                    title="Add Child">
                    <i class="fas fa-plus"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Children Cards Container -->
    <div class="p-3 sm:p-6">
        {% if children %}
        <div class="grid grid-cols-1 gap-3 sm:gap-6">
            {% for child in children %}
            <div class="bg-gray-50 border-2 border-gray-300 shadow-md hover:shadow-xl hover:border-gray-400 transition-all duration-300 group cursor-pointer relative"
                onclick="window.location.href='{% url 'child_entries' child.id %}'">
                <!-- Child Color Accent Bar -->
                <div class="h-1 w-full" style="background-color: {{ child.colour }};"></div>

                <!-- Main Content Area -->
                <div class="p-3 flex items-center justify-between">
                    <!-- Left Side: Avatar and Info -->
                    <div class="flex items-center">
                        <div class="w-8 h-8 border-2 border-primary flex items-center justify-center text-sm font-normal text-white mr-3"
                            style="background-color: {{ child.colour }};">
                            {{ child.name|first|upper }}
                        </div>
                        <div>
                            <h3 class="text-base responsive-text-base font-normal text-gray-900 tracking-wide">{{ child.name }}</h3>
                            {% if child.school %}
                            <p class="text-gray-600 font-medium text-xs responsive-text-sm">{{ child.school }}</p>
                            {% endif %}
                            {% if child.year %}
                            <p class="text-gray-500 text-xs responsive-text-sm font-medium">{{ child.year }}{% if child.class_name %} - {{ child.class_name }}{% endif %}</p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Right Side: Action Icons Stacked -->
                    <div class="flex flex-col gap-1">
                        <!-- Edit Icon -->
                        <a href="{% url 'edit_child' child.id %}"
                            class="w-6 h-6 bg-green-600 hover:bg-green-700 text-white border border-green-800 flex items-center justify-center transition-all duration-200 z-10 rounded-sm"
                            onclick="event.stopPropagation();" title="Edit {{ child.name }}'s profile">
                            <i class="fas fa-pencil-alt text-xs"></i>
                        </a>

                        <!-- Manage Icon -->
                        <div class="w-6 h-6 bg-primary border border-primary flex items-center justify-center"
                            title="Click to manage entries">
                            <span class="text-white text-xs">→</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-4 sm:py-8">
            <div
                class="w-16 h-16 sm:w-24 sm:h-24 mx-auto mb-3 sm:mb-6 bg-gray-100 border-2 border-primary flex items-center justify-center">
                <div class="w-8 h-8 sm:w-12 sm:h-12 bg-primary border-2 border-primary"></div>
            </div>
            <a href="{% url 'add_child' %}"
                class="bg-primary hover:bg-secondary text-white font-normal px-4 py-2 sm:px-8 sm:py-4 border-2 border-primary transition-all duration-200 tracking-wide hover:shadow-lg text-sm sm:text-base inline-flex items-center gap-2"
                title="Add Your First Child">
                <i class="fas fa-plus"></i>
                <span>Add Your First Child</span>
            </a>
        </div>
        {% endif %}
    </div>
</div>
    </div>
    
    <!-- Right Column: Timeline Section - Expands to fill remaining space -->
    <div class="w-full md:flex-1 md:h-full">
        <!-- Clean Timeline Section from Child Page -->
        <div class="bg-white border-2 border-primary shadow-lg h-full flex flex-col">
            <div class="border-b-2 border-primary bg-gray-50 px-3 py-2 sm:px-6 sm:py-4 flex-shrink-0">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg sm:text-xl md:text-2xl lg:text-3xl responsive-text-2xl font-normal text-gray-900 tracking-wide">Tasks & Events</h3>
                    <div class="flex items-center gap-2">
                        <!-- 🔒 PROTECTED TOGGLE BUTTONS - DO NOT MODIFY 🔒 -->
                        <!-- These buttons are EXACT copies from childEntries.html -->
                        <!-- User explicitly requested these NOT be changed again -->
                        <!-- If changes are needed, confirm with user first and remind them of this protection -->
                        <nav class="flex gap-2">
                            <a href="?type=" class="py-2 px-4 border-2 font-normal text-xs sm:text-sm tracking-wide transition-all duration-200 {% if not request.GET.type %}bg-primary text-white border-primary{% else %}bg-white text-gray-700 border-gray-300 hover:border-primary hover:text-primary{% endif %}">
                                All
                            </a>
                            <a href="?type=task" class="py-2 px-4 border-2 font-normal text-xs sm:text-sm tracking-wide transition-all duration-200 {% if request.GET.type == 'task' %}bg-amber-600 text-white border-amber-600{% else %}bg-white text-gray-700 border-gray-300 hover:border-amber-600 hover:text-amber-600{% endif %}">
                                Tasks
                            </a>
                            <a href="?type=event" class="py-2 px-4 border-2 font-normal text-xs sm:text-sm tracking-wide transition-all duration-200 {% if request.GET.type == 'event' %}bg-violet-600 text-white border-violet-600{% else %}bg-white text-gray-700 border-gray-300 hover:border-violet-600 hover:text-violet-600{% endif %}">
                                Events
                            </a>
                        </nav>
                        <!-- 🔒 END PROTECTED TOGGLE BUTTONS 🔒 -->
                        <div class="border-l-2 border-primary pl-3 sm:pl-4 flex items-center justify-center">
                            <a href="{% url 'add_entry' %}" class="bg-primary hover:bg-secondary text-white font-normal px-3 py-2 sm:px-4 sm:py-3 border-2 border-primary transition-all duration-200 tracking-wide text-xs sm:text-sm hover:shadow-lg flex items-center justify-center">
                                <i class="fas fa-plus"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Timeline Content -->
            <div class="p-4 flex-1 overflow-y-auto">
                {% if active_entries %}
                    <div class="space-y-3">
                        {% for entry in active_entries|slice:":10" %}
                            <div class="{% if entry.entry_type == 'task' %}bg-amber-50 border-l-4 border-amber-600{% elif entry.entry_type == 'event' %}bg-violet-50 border-l-4 border-violet-600{% elif entry.entry_type == 'note' %}bg-green-50 border-l-4 border-green-600{% endif %} p-4 {% if entry.entry_type == 'task' %}hover:bg-amber-100{% elif entry.entry_type == 'event' %}hover:bg-violet-100{% elif entry.entry_type == 'note' %}hover:bg-green-100{% endif %} transition-all duration-200 entry-card" data-entry-type="{{ entry.entry_type }}">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-900 mb-2">{{ entry.title }}</h4>
                                        {% if entry.description %}
                                            <p class="text-gray-700 text-sm mb-2">{{ entry.description }}</p>
                                        {% endif %}
                                        <div class="flex flex-wrap gap-1 mb-2">
                                            {% if entry.entry_type == 'task' %}
                                                <span class="bg-amber-600 text-white px-2 py-1 text-xs rounded-sm font-medium">Task</span>
                                                {% if entry.priority %}
                                                    <span class="bg-gray-200 text-gray-700 px-2 py-1 text-xs rounded-sm">{{ entry.get_priority_display }}</span>
                                                {% endif %}
                                            {% elif entry.entry_type == 'event' %}
                                                <span class="bg-violet-600 text-white px-2 py-1 text-xs rounded-sm font-medium">Event</span>
                                                {% if entry.location %}
                                                    <span class="bg-gray-200 text-gray-700 px-2 py-1 text-xs rounded-sm">📍 {{ entry.location }}</span>
                                                {% endif %}
                                            {% elif entry.entry_type == 'note' %}
                                                <span class="bg-green-600 text-white px-2 py-1 text-xs rounded-sm font-medium">Note</span>
                                            {% endif %}
                                            {% if entry.category and entry.category != 'none' %}
                                                <span class="bg-gray-200 text-gray-700 px-2 py-1 text-xs rounded-sm">{{ entry.get_category_display }}</span>
                                            {% endif %}
                                        </div>
                                        <!-- Child name and date info -->
                                        <div class="flex items-center space-x-2 mb-2">
                                            <span class="font-medium text-xs" style="color: {{ entry.child.colour }};">{{ entry.child.name }}</span>
                                            <span class="text-gray-400 text-xs">•</span>
                                            <span class="text-xs text-gray-500">
                                                {% if entry.entry_type == 'task' and entry.due_date %}
                                                    Due: {{ entry.due_date|date:"M j, Y" }}{% if entry.due_time %} at {{ entry.due_time|time:"g:i A" }}{% endif %}
                                                {% elif entry.entry_type == 'event' and entry.event_date %}
                                                    {{ entry.event_date|date:"M j, Y" }}{% if entry.start_time %} from {{ entry.start_time|time:"g:i A" }}{% endif %}{% if entry.end_time %} to {{ entry.end_time|time:"g:i A" }}{% endif %}
                                                {% else %}
                                                    {{ entry.date_created|date:"M j, Y" }}
                                                {% endif %}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="flex flex-col gap-1 ml-4">
                                        <a href="{% url 'edit_entry' entry.id %}" class="w-6 h-6 {% if entry.entry_type == 'task' %}bg-amber-600 hover:bg-amber-700 border-amber-800{% elif entry.entry_type == 'event' %}bg-violet-600 hover:bg-violet-700 border-violet-800{% elif entry.entry_type == 'note' %}bg-green-600 hover:bg-green-700 border-green-800{% endif %} text-white border flex items-center justify-center transition-all duration-200 rounded-sm" title="Edit">
                                            <i class="fas fa-pencil-alt text-xs"></i>
                                        </a>
                                        <form method="post" action="{% url 'quick_delete_entry' entry.id %}" style="display: inline;" onsubmit="return confirm('Delete this entry?')">
                                            {% csrf_token %}
                                            <button type="submit" class="w-6 h-6 bg-red-600 hover:bg-red-700 text-white border border-red-800 flex items-center justify-center transition-all duration-200 rounded-sm" title="Delete">
                                                <i class="fas fa-trash text-xs"></i>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8">
                        <div class="w-16 h-16 mx-auto mb-4 bg-primary/10 border-2 border-primary flex items-center justify-center rounded-lg">
                            <i class="fas fa-plus text-2xl text-primary"></i>
                        </div>
                        <h4 class="text-lg font-medium text-gray-900 mb-2">No entries yet</h4>
                        {% if children %}
                            <p class="text-gray-600 text-sm mb-4">Start by adding tasks or events for your children</p>
                            <a href="{% url 'add_entry' %}" class="bg-primary hover:bg-secondary text-white font-normal py-2 px-4 border-2 border-primary transition-all duration-200 tracking-wide hover:shadow-lg text-sm">
                                <i class="fas fa-plus mr-1"></i>
                                Add First Entry
                            </a>
                        {% else %}
                            <p class="text-gray-600 text-sm mb-4">Add a child profile first, then you can start creating entries</p>
                            <a href="{% url 'add_child' %}" class="bg-primary hover:bg-secondary text-white font-normal py-2 px-4 border-2 border-primary transition-all duration-200 tracking-wide hover:shadow-lg text-sm">
                                <i class="fas fa-plus mr-1"></i>
                                Add Child Profile
                            </a>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    <!-- End Right Column: Timeline Section -->

    <!-- Notes Section - Only visible on 2560px+ screens -->
    <div class="hidden ultra-wide-notes w-full h-full">
        <div class="bg-white border-2 border-primary shadow-lg h-full flex flex-col">
            <div class="border-b-2 border-primary bg-green-50 px-3 py-2 sm:px-6 sm:py-4 flex-shrink-0">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg sm:text-xl md:text-2xl lg:text-3xl responsive-text-2xl font-normal text-green-700 tracking-wide">
                        Notes
                    </h3>
                    <div class="border-l-2 border-primary pl-3 sm:pl-4 flex items-center justify-center">
                        <a href="{% url 'add_entry' %}?entry_type=note" class="bg-green-600 hover:bg-green-700 text-white font-normal px-3 py-2 sm:px-4 sm:py-3 border-2 border-green-600 transition-all duration-200 tracking-wide text-xs sm:text-sm hover:shadow-lg flex items-center justify-center">
                            <i class="fas fa-plus"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Notes Content -->
            <div class="p-3 overflow-y-auto flex-1">
                {% if active_entries %}
                    {% with note_entries=active_entries|dictsort:"created_at" %}
                        {% if note_entries %}
                            <div class="space-y-2">
                                {% for entry in note_entries %}
                                    {% if entry.entry_type == 'note' %}
                                        <div class="bg-green-50 border-l-4 border-green-600 p-3 hover:bg-green-100 transition-all duration-200">
                                            <div class="flex justify-between items-start">
                                                <div class="flex-1">
                                                    <h4 class="font-medium text-gray-900 mb-1">{{ entry.title }}</h4>
                                                    {% if entry.description %}
                                                        <p class="text-gray-700 text-xs mb-2">{{ entry.description }}</p>
                                                    {% endif %}
                                                    {% if entry.category and entry.category != 'none' %}
                                                        <span class="inline-block bg-gray-200 text-gray-700 px-2 py-0.5 text-xs rounded-sm mr-1">
                                                            {{ entry.get_category_display }}
                                                        </span>
                                                    {% endif %}
                                                    <div class="flex items-center justify-between mt-1">
                                                        <p class="text-xs text-gray-500">{{ entry.created_at|date:"M j, Y g:i A" }}</p>
                                                        <span class="font-medium text-xs" style="color: {{ entry.child.colour }};">{{ entry.child.name }}</span>
                                                    </div>
                                                </div>
                                                <div class="flex flex-col gap-1 ml-2">
                                                    <a href="{% url 'edit_entry' entry.id %}" class="w-5 h-5 bg-green-600 hover:bg-green-700 text-white border border-green-800 flex items-center justify-center transition-all duration-200 rounded-sm" title="Edit Note">
                                                        <i class="fas fa-pencil-alt text-xs"></i>
                                                    </a>
                                                    <form method="post" action="{% url 'delete_entry' entry.id %}" style="display: inline;" onsubmit="return confirm('Delete this note?')">
                                                        {% csrf_token %}
                                                        <button type="submit" class="w-5 h-5 bg-red-600 hover:bg-red-700 text-white border border-red-800 flex items-center justify-center transition-all duration-200 rounded-sm" title="Delete Note">
                                                            <i class="fas fa-trash text-xs"></i>
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="text-center py-6">
                                <div class="w-12 h-12 mx-auto mb-3 bg-green-100 border-2 border-green-600 flex items-center justify-center rounded-lg">
                                    <i class="fas fa-plus text-lg text-green-600"></i>
                                </div>
                                <h4 class="text-sm font-medium text-gray-900 mb-1">No notes yet</h4>
                                <p class="text-gray-600 text-xs mb-3">Add your first note to get started!</p>
                                <a href="{% url 'add_entry' %}?entry_type=note" class="bg-green-600 hover:bg-green-700 text-white font-normal py-1 px-3 border-2 border-green-600 transition-all duration-200 tracking-wide text-xs">
                                    <i class="fas fa-plus mr-1"></i>
                                    Add Note
                                </a>
                            </div>
                        {% endif %}
                    {% endwith %}
                {% else %}
                    <div class="text-center py-6">
                        <div class="w-12 h-12 mx-auto mb-3 bg-green-100 border-2 border-green-600 flex items-center justify-center rounded-lg">
                            <i class="fas fa-plus text-lg text-green-600"></i>
                        </div>
                        <h4 class="text-sm font-medium text-gray-900 mb-1">No notes yet</h4>
                        <p class="text-gray-600 text-xs mb-3">Add your first note to get started!</p>
                        <a href="{% url 'add_entry' %}?entry_type=note" class="bg-green-600 hover:bg-green-700 text-white font-normal py-1 px-3 border-2 border-green-600 transition-all duration-200 tracking-wide text-xs">
                            <i class="fas fa-plus mr-1"></i>
                            Add Note
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    <!-- End Notes Section -->

</div>
<!-- End Two-column layout wrapper -->
</div>
<!-- End dashboard container -->

{% endblock %}