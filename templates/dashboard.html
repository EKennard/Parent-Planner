{% extends 'base.html' %}

{% block title %}Dashboard - ParentPlanner{% endblock %}

{% block extra_head %}
<!-- Optimized dashboard assets -->
{% load static %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<link rel="stylesheet" href="{% static 'css/dashboard-scroll.css' %}">
<script src="{% static 'js/dashboard-optimized.js' %}" defer></script>
<script src="{% static 'js/color_picker.js' %}" defer></script>

<style>
/* Color Picker Styling */
.color-grid-widget {
    margin: 0.5rem 0;
}

.color-dots-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 0.5rem;
    padding: 1rem;
    background-color: #f9fafb;
    border: 2px solid #4F46E5;
    max-width: 250px;
}

.color-dot {
    width: 2rem;
    height: 2rem;
    border: 2px solid #6b7280;
    cursor: pointer;
    transition: all 0.2s ease;
    justify-self: center;
    border-radius: 50%;
}

.color-dot:hover {
    transform: scale(1.1);
    border-color: #111827;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.color-dot.selected {
    border-color: #4f46e5;
    transform: scale(1.15);
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.3), 0 2px 8px rgba(0, 0, 0, 0.3);
    border-width: 3px;
}

.color-dot-small {
    border-radius: 50%;
    transition: all 0.2s ease;
    border: 2px solid #666;
}

.color-dot-small:hover {
    transform: scale(1.1);
    border-color: #111;
}

.color-dot-small.selected {
    border-color: #4f46e5;
    transform: scale(1.15);
    border-width: 3px;
    box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.3);
}

.force-visible {
    display: block !important;
    visibility: visible !important;
}
</style>

<script>
    let selectedChildId = null;
    
    function toggleNotesForm() {
        const mobileForm = document.getElementById('notesFormMobile');
        const desktopForm = document.getElementById('notesFormDesktop');
        if (mobileForm) mobileForm.classList.toggle('hidden');
        if (desktopForm) desktopForm.classList.toggle('hidden');
    }
    
        function toggleChildForm(isMobile = false) {
        const desktopForm = document.getElementById('childFormDesktop');
        const mobileForm = document.getElementById('childFormMobile');
        if (isMobile && mobileForm) mobileForm.classList.toggle('hidden');
        if (!isMobile && desktopForm) desktopForm.classList.toggle('hidden');
    }

    function selectChildColor(colorDot, childId) {
        // Remove selected class from all color dots for this child
        const parentForm = colorDot.closest('form');
        if (parentForm) {
            parentForm.querySelectorAll('.color-dot-small').forEach(dot => {
                dot.classList.remove('selected');
                dot.style.borderWidth = '1px';
                dot.style.borderColor = '#666';
            });
        }
        
        // Add selected class to clicked dot
        colorDot.classList.add('selected');
        colorDot.style.borderWidth = '3px';
        colorDot.style.borderColor = '#4F46E5';
        
        // Update hidden input
        const colorInput = document.getElementById(`childColor${childId}`);
        if (colorInput) {
            colorInput.value = colorDot.dataset.color;
        }
    }

    function toggleEntryForm(isMobile = false) {
        const mobileForm = document.getElementById('entryFormMobile');
        const desktopForm = document.getElementById('entryFormDesktop');
        if (mobileForm) mobileForm.classList.toggle('hidden');
        if (desktopForm) desktopForm.classList.toggle('hidden');
    }
    
    function selectChild(childId, childName) {
        selectedChildId = childId;
        
        // Update child selection in forms
        const childSelects = document.querySelectorAll('select[name="child"]');
        childSelects.forEach(select => {
            select.value = childId;
        });
        
        // Filter entries and notes to show only selected child's content
        filterContentByChild(childId);
        
        // Update UI to show selected child
        updateSelectedChildUI(childId, childName);
    }

    // Initialize color selection when page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Set up color selection for each child edit form
        const childCards = document.querySelectorAll('.child-card');
        childCards.forEach(card => {
            const childId = card.dataset.childId;
            const colorInput = document.getElementById(`childColor${childId}`);
            if (colorInput) {
                const currentColor = colorInput.value;
                const colorDot = card.querySelector(`[data-color="${currentColor}"]`);
                if (colorDot) {
                    colorDot.classList.add('selected');
                    colorDot.style.borderWidth = '3px';
                    colorDot.style.borderColor = '#4F46E5';
                }
            }
        });
    });

    function toggleChildEdit(childId) {
        // Find forms for both mobile and desktop with correct IDs
        const mobileForm = document.getElementById(`childEdit${childId}Mobile`);
        const desktopForm = document.getElementById(`childEdit${childId}Desktop`);
        
        // Get child name for selection
        const childCard = document.querySelector(`[data-child-id="${childId}"]`);
        const childNameElement = childCard ? childCard.querySelector('h3') : null;
        const childName = childNameElement ? childNameElement.textContent.trim() : `Child ${childId}`;
        
        // Select the child first (filter entries and update UI)
        selectChild(childId, childName);
        
        // Toggle the forms exactly like other forms
        if (mobileForm) mobileForm.classList.toggle('hidden');
        if (desktopForm) desktopForm.classList.toggle('hidden');
    }
    
    // Filter only entries and notes, NOT child cards
    function filterEntriesOnly(childId) {
        const entries = document.querySelectorAll('[data-child-id]');
        entries.forEach(entry => {
            // Skip child cards - only filter actual content
            if (!entry.classList.contains('child-card')) {
                if (entry.dataset.childId == childId) {
                    entry.style.display = 'block';
                } else {
                    entry.style.display = 'none';
                }
            }
        });
    }
    
    // Update only headers, not child card states
    function updateHeadersOnly(childId, childName) {
        const headers = document.querySelectorAll('.child-header-text');
        headers.forEach(header => {
            header.textContent = childName + "'s Tasks & Events";
        });
        
        const noteHeaders = document.querySelectorAll('.notes-header-text');
        noteHeaders.forEach(header => {
            header.textContent = childName + "'s Notes";
        });
    }
    
    function showAllChildren() {
        selectedChildId = null;
        
        // Hide all edit forms first (close any open child edit forms)
        const allEditFormsMobile = document.querySelectorAll('[id^="childEdit"][id$="Mobile"]');
        const allEditFormsDesktop = document.querySelectorAll('[id^="childEdit"][id$="Desktop"]');
        allEditFormsMobile.forEach(form => form.classList.add('hidden'));
        allEditFormsDesktop.forEach(form => form.classList.add('hidden'));
        
        // Show all content entries (but child cards should always be visible)
        const entries = document.querySelectorAll('[data-child-id]');
        entries.forEach(entry => {
            entry.style.display = 'block';
        });
        
        // Reset child selection in forms
        const childSelects = document.querySelectorAll('select[name="child"]');
        childSelects.forEach(select => {
            select.selectedIndex = 0;
        });
        
        // Reset UI
        updateSelectedChildUI(null, 'All Children');
    }
    
    function filterContentByChild(childId) {
        const entries = document.querySelectorAll('[data-child-id]');
        entries.forEach(entry => {
            // Skip child cards - only filter actual content entries
            if (!entry.classList.contains('child-card')) {
                if (entry.dataset.childId == childId) {
                    entry.style.display = 'block';
                } else {
                    entry.style.display = 'none';
                }
            }
        });
    }
    
    function updateSelectedChildUI(childId, childName) {
        // Update header text
        const headers = document.querySelectorAll('.child-header-text');
        headers.forEach(header => {
            header.textContent = childName + (childId ? "'s Tasks & Events" : " Overview");
        });
        
        const noteHeaders = document.querySelectorAll('.notes-header-text');
        noteHeaders.forEach(header => {
            header.textContent = childId ? childName + "'s Notes" : "All Notes";
        });
        
        // Update child cards active state
        const childCards = document.querySelectorAll('.child-card');
        childCards.forEach(card => {
            if (card.dataset.childId == childId) {
                card.classList.add('border-primary', 'bg-blue-50');
                card.classList.remove('border-gray-300');
            } else {
                card.classList.remove('border-primary', 'bg-blue-50');
                card.classList.add('border-gray-300');
            }
        });
    }
</script>
{% endblock %}

{% block content %}
<div class="overflow-hidden" style="height: calc(100vh - 80px);">
    <!-- Message System -->
    {% if messages %}
    <div class="flex-shrink-0 px-3 sm:px-6 pt-4 pb-2">
        {% for message in messages %}
        {# Filter out unwanted allauth messages #}
        {% if "Successfully signed in" not in message|stringformat:"s" and "You have signed out" not in message|stringformat:"s" %}
        <div class="border-l-4 p-2 sm:p-4 mb-2 text-sm sm:text-base {% if message.tags == 'success' %}bg-green-50 border-green-500 text-green-800{% elif message.tags == 'error' %}bg-red-50 border-red-500 text-red-800{% else %}bg-blue-50 border-blue-500 text-blue-800{% endif %}">
            <div class="flex items-center">
                <span class="font-medium">{{ message }}</span>
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    <!-- Main Content with Child Page Layout -->
    <div class="px-3 sm:px-6 py-6" style="height: calc(100vh - 140px);">
        
        {% if children_count == 0 %}
            <!-- Empty State: No Children -->
            {% include 'widgets/dashboard_empty.html' %}
        {% else %}
            <!-- Unified Dashboard: Child Page Layout with Multiple Children Support -->
            
            <!-- Mobile Layout: Horizontal Swipe -->
            <div class="md:hidden">
                <!-- Children Header (Fixed) -->
                <div class="bg-white border-2 border-primary shadow-lg mb-4">
                    <div class="border-b-2 border-primary bg-gray-50 px-3 py-2 sm:px-6 sm:py-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <h1 class="text-lg sm:text-xl md:text-2xl lg:text-3xl font-normal text-gray-900 tracking-wide child-header-text">Family Dashboard</h1>
                                <p class="text-gray-600 font-medium text-xs">{{ children_count }} children, {{ total_entries }} total entries</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="toggleChildForm(true)" class="bg-secondary hover:bg-purple-700 text-white p-2 border-2 border-secondary transition-all duration-200 hover:shadow-lg">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button onclick="showAllChildren()" class="bg-secondary hover:bg-purple-700 text-white font-normal px-3 py-2 border-2 border-secondary transition-all duration-200 tracking-wide text-xs">
                                    All
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Children Cards Horizontal Scroll -->
                    <div class="p-3 overflow-x-auto" style="overflow-y: visible;">
                        <div class="flex gap-3" style="width: max-content; overflow: visible;">
                            {% for child in children %}
                            <div class="child-card border-2 border-gray-300 bg-white cursor-pointer hover:bg-gray-50 transition-all duration-200 flex-shrink-0 w-32 relative" 
                                 data-child-id="{{ child.id }}" style="overflow: visible; z-index: 10;">
                                <div class="p-3 text-center" onclick="toggleChildEdit({{ child.id }})">
                                    <div class="w-8 h-8 mx-auto border-2 border-primary flex items-center justify-center text-white font-normal text-sm tracking-wide mb-2" 
                                         style="background-color: {{ child.colour }};">
                                        {{ child.name|first|upper }}
                                    </div>
                                    <h3 class="text-xs font-medium text-gray-900">{{ child.name }}</h3>
                                </div>
                                
                                <!-- Child Edit Form Dropdown -->
                                <div id="childEdit{{ child.id }}Mobile" class="hidden border-t-2 border-secondary bg-purple-25 p-2 rounded-none" style="border-radius: 0;">
                                    <form method="post" action="{% url 'edit_child' child.id %}" class="space-y-2">
                                        {% csrf_token %}
                                        
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">Name</label>
                                            <input type="text" name="name" value="{{ child.name }}" 
                                                   class="w-full px-2 py-1 border-2 border-gray-300 focus:border-secondary focus:outline-none text-xs rounded-none" style="border-radius: 0;">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">Date of Birth</label>
                                            <input type="date" name="birth_date" value="{{ child.birth_date|date:'Y-m-d' }}" 
                                                   class="w-full px-2 py-1 border-2 border-gray-300 focus:border-secondary focus:outline-none text-xs rounded-none" style="border-radius: 0;">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">School</label>
                                            <input type="text" name="school" value="{{ child.school|default:'' }}" 
                                                   class="w-full px-2 py-1 border-2 border-gray-300 focus:border-secondary focus:outline-none text-xs rounded-none" style="border-radius: 0;">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">Year</label>
                                            <input type="text" name="year" value="{{ child.year|default:'' }}" 
                                                   class="w-full px-2 py-1 border-2 border-gray-300 focus:border-secondary focus:outline-none text-xs rounded-none" style="border-radius: 0;">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">Class</label>
                                            <input type="text" name="class_name" value="{{ child.class_name|default:'' }}" 
                                                   class="w-full px-2 py-1 border-2 border-gray-300 focus:border-secondary focus:outline-none text-xs rounded-none" style="border-radius: 0;">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">Color</label>
                                            <div class="flex gap-1 flex-wrap">
                                                <div class="color-dot-small w-3 h-3 border-2 cursor-pointer rounded-none {{ child.colour|yesno:'selected,' }}" 
                                                     data-color="#FF6B6B" style="background-color: #FF6B6B; border-radius: 0;" 
                                                     onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                <div class="color-dot-small w-3 h-3 border-2 cursor-pointer rounded-none" 
                                                     data-color="#4ECDC4" style="background-color: #4ECDC4; border-radius: 0;" 
                                                     onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                <div class="color-dot-small w-3 h-3 border-2 cursor-pointer rounded-none" 
                                                     data-color="#0D6A80" style="background-color: #0D6A80; border-radius: 0;" 
                                                     onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                <div class="color-dot-small w-3 h-3 border-2 cursor-pointer rounded-none" 
                                                     data-color="#96CEB4" style="background-color: #96CEB4; border-radius: 0;" 
                                                     onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                <div class="color-dot-small w-3 h-3 border-2 cursor-pointer rounded-none" 
                                                     data-color="#D1D811" style="background-color: #D1D811; border-radius: 0;" 
                                                     onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                <div class="color-dot-small w-3 h-3 border-2 cursor-pointer rounded-none" 
                                                     data-color="#DDA0DD" style="background-color: #DDA0DD; border-radius: 0;" 
                                                     onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                <div class="color-dot-small w-3 h-3 border-2 cursor-pointer rounded-none" 
                                                     data-color="#AD6A0D" style="background-color: #AD6A0D; border-radius: 0;" 
                                                     onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                <div class="color-dot-small w-3 h-3 border-2 cursor-pointer rounded-none" 
                                                     data-color="#8516EE" style="background-color: #8516EE; border-radius: 0;" 
                                                     onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                <div class="color-dot-small w-3 h-3 border-2 cursor-pointer rounded-none" 
                                                     data-color="#0CEB0C" style="background-color: #0CEB0C; border-radius: 0;" 
                                                     onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                <div class="color-dot-small w-3 h-3 border-2 cursor-pointer rounded-none" 
                                                     data-color="#BE12E0" style="background-color: #BE12E0; border-radius: 0;" 
                                                     onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                            </div>
                                            <input type="hidden" name="colour" value="{{ child.colour }}" id="childColor{{ child.id }}">
                                        </div>
                                        
                                        <div class="flex gap-1 pt-1">
                                            <button type="submit" class="bg-secondary hover:bg-purple-700 text-white font-normal py-1 px-2 border-2 border-secondary transition-all duration-200 tracking-wide text-xs rounded-none" style="border-radius: 0;">
                                                Save
                                            </button>
                                            <button type="button" onclick="toggleChildEdit({{ child.id }})" class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-normal py-1 px-2 border-2 border-gray-300 transition-all duration-200 tracking-wide text-xs rounded-none" style="border-radius: 0;">
                                                Cancel
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Child Form Mobile -->
                    <div id="childFormMobile" class="hidden border-b-2 border-secondary bg-purple-25 p-2 rounded-none" style="border-radius: 0;">
                        <form method="post" class="space-y-2">
                            {% csrf_token %}
                            <input type="hidden" name="add_child" value="1">
                            
                            <div>
                                <label for="{{ child_form.name.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">Name</label>
                                {{ child_form.name }}
                            </div>
                            
                            <div>
                                <label for="{{ child_form.birth_date.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">{{ child_form.birth_date.label }}</label>
                                {{ child_form.birth_date }}
                                {% if child_form.birth_date.help_text %}
                                    <p class="text-xs text-gray-500 mt-1">{{ child_form.birth_date.help_text }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label for="{{ child_form.school.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">School</label>
                                {{ child_form.school }}
                            </div>
                            
                            <div>
                                <label for="{{ child_form.year.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">Year</label>
                                {{ child_form.year }}
                            </div>
                            
                            <div>
                                <label for="{{ child_form.class_name.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">Class</label>
                                {{ child_form.class_name }}
                            </div>
                            
                            <div>
                                <label for="{{ child_form.colour.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">Colour</label>
                                <!-- Hidden select field -->
                                {{ child_form.colour }}
                                
                                <!-- Custom color grid -->
                                <div class="color-grid-widget rounded-none" data-target="{{ child_form.colour.id_for_label }}" style="border-radius: 0;">
                                    <div class="color-dots-grid">
                                        <div class="color-dot selected rounded-none" 
                                             data-color="#FF6B6B"
                                             onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                             style="background-color: #FF6B6B; border-radius: 0;"
                                             title="Coral Red">
                                        </div>
                                        <div class="color-dot rounded-none" 
                                             data-color="#4ECDC4"
                                             onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                             style="background-color: #4ECDC4; border-radius: 0;"
                                             title="Turquoise">
                                        </div>
                                        <div class="color-dot rounded-none" 
                                             data-color="#0D6A80"
                                             onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                             style="background-color: #0D6A80; border-radius: 0;"
                                             title="Sky Blue">
                                        </div>
                                        <div class="color-dot rounded-none" 
                                             data-color="#96CEB4"
                                             onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                             style="background-color: #96CEB4; border-radius: 0;"
                                             title="Mint Green">
                                        </div>
                                        <div class="color-dot rounded-none" 
                                             data-color="#D1D811"
                                             onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                             style="background-color: #D1D811; border-radius: 0;"
                                             title="Sunny Yellow">
                                        </div>
                                        <div class="color-dot rounded-none" 
                                             data-color="#DDA0DD"
                                             onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                             style="background-color: #DDA0DD; border-radius: 0;"
                                             title="Plum Purple">
                                        </div>
                                        <div class="color-dot rounded-none" 
                                             data-color="#AD6A0D"
                                             onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                             style="background-color: #AD6A0D; border-radius: 0;"
                                             title="Peach Orange">
                                        </div>
                                        <div class="color-dot rounded-none" 
                                             data-color="#8516EE"
                                             onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                             style="background-color: #8516EE; border-radius: 0;"
                                             title="Light Blue">
                                        </div>
                                        <div class="color-dot rounded-none" 
                                             data-color="#0CEB0C"
                                             onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                             style="background-color: #0CEB0C; border-radius: 0;"
                                             title="Pale Green">
                                        </div>
                                        <div class="color-dot rounded-none" 
                                             data-color="#BE12E0"
                                             onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                             style="background-color: #BE12E0; border-radius: 0;"
                                             title="Bright Pink">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex gap-1 pt-1">
                                <button type="submit" class="bg-secondary hover:bg-purple-700 text-white font-normal py-1 px-2 border-2 border-secondary transition-all duration-200 tracking-wide text-xs rounded-none" style="border-radius: 0;">
                                    Add Child
                                </button>
                                <button type="button" onclick="toggleChildForm(true)" class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-normal py-1 px-2 border-2 border-gray-300 transition-all duration-200 tracking-wide text-xs rounded-none" style="border-radius: 0;">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Horizontal Swipe Container -->
                <div class="overflow-x-auto" style="height: calc(100vh - 200px);">
                    <div class="flex space-x-4 h-full" style="width: 200%;">
                        <!-- Timeline Section (50% of container width) -->
                        <div class="w-1/2 bg-white border-2 border-primary shadow-lg h-full flex flex-col">
                            <div class="border-b-2 border-primary bg-gray-50 px-3 py-2 sm:px-6 sm:py-4 flex-shrink-0">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-lg sm:text-xl font-normal text-gray-900 tracking-wide child-header-text">Tasks & Events</h3>
                                    <div class="flex items-center gap-2">
                                        <nav class="flex gap-2">
                                            <a href="?type=" class="py-2 px-4 border-2 font-normal text-xs tracking-wide transition-all duration-200 {% if not request.GET.type %}bg-primary text-white border-primary{% else %}bg-white text-gray-700 border-gray-300 hover:border-primary hover:text-primary{% endif %}">
                                                All
                                            </a>
                                            <a href="?type=task" class="py-2 px-4 border-2 font-normal text-xs tracking-wide transition-all duration-200 {% if request.GET.type == 'task' %}bg-amber-600 text-white border-amber-600{% else %}bg-white text-gray-700 border-gray-300 hover:border-amber-600 hover:text-amber-600{% endif %}">
                                                Tasks
                                            </a>
                                            <a href="?type=event" class="py-2 px-4 border-2 font-normal text-xs tracking-wide transition-all duration-200 {% if request.GET.type == 'event' %}bg-violet-600 text-white border-violet-600{% else %}bg-white text-gray-700 border-gray-300 hover:border-violet-600 hover:text-violet-600{% endif %}">
                                                Events
                                            </a>
                                        </nav>
                                        <div class="border-l-2 border-primary pl-3 flex items-center justify-center">
                                            <button onclick="toggleEntryForm()" class="bg-primary hover:bg-secondary text-white font-normal px-3 py-2 border-2 border-primary transition-all duration-200 tracking-wide text-xs hover:shadow-lg flex items-center justify-center">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Entry Form -->
                            <div id="entryFormMobile" class="hidden border-b-2 border-primary bg-gray-25 p-2 rounded-none" style="border-radius: 0;">
                                <form method="post" class="space-y-2">
                                    {% csrf_token %}
                                    <input type="hidden" name="add_entry" value="1">
                                    
                                    <div>
                                        <label for="{{ form.title.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">Title</label>
                                        {{ form.title }}
                                    </div>
                                    
                                    <div>
                                        <label for="{{ form.entry_type.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">Type</label>
                                        {{ form.entry_type }}
                                    </div>
                                    
                                    <div>
                                        <label for="{{ form.child.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">Child</label>
                                        {{ form.child }}
                                    </div>
                                    
                                    <div>
                                        <label for="{{ form.category.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">Category</label>
                                        {{ form.category }}
                                    </div>
                                    
                                    <div>
                                        <label for="{{ form.description.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">Description</label>
                                        {{ form.description }}
                                    </div>
                                    
                                    <div class="flex gap-1 pt-1">
                                        <button type="submit" class="bg-primary hover:bg-secondary text-white font-normal py-1 px-2 border-2 border-primary transition-all duration-200 tracking-wide text-xs rounded-none" style="border-radius: 0;">
                                            Save Entry
                                        </button>
                                        <button type="button" onclick="toggleEntryForm()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-normal py-1 px-2 border-2 border-gray-300 transition-all duration-200 tracking-wide text-xs rounded-none" style="border-radius: 0;">
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Timeline Content -->
                            <div class="p-3 overflow-y-auto flex-1">
                                {% if active_entries %}
                                    <div class="space-y-2">
                                        {% for entry in active_entries %}
                                            <div class="{% if entry.entry_type == 'task' %}bg-amber-50 border-l-4 border-amber-600{% elif entry.entry_type == 'event' %}bg-violet-50 border-l-4 border-violet-600{% endif %} p-3 hover:bg-opacity-80 transition-all duration-200" 
                                                 data-child-id="{{ entry.child.id }}">
                                                <div class="flex justify-between items-start">
                                                    <div class="flex-1">
                                                        <h4 class="font-medium text-gray-900 text-sm">{{ entry.title }}</h4>
                                                        <p class="text-gray-600 text-xs mt-1">{{ entry.description|truncatewords:10 }}</p>
                                                        <div class="flex items-center gap-2 mt-2 text-xs text-gray-500">
                                                            <span class="bg-gray-100 px-2 py-1 border">{{ entry.child.name }}</span>
                                                            <span>{{ entry.created_at|date:"M d" }}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <div class="text-center py-12">
                                        <div class="w-16 h-16 mx-auto mb-4 bg-gray-100 border-2 border-primary flex items-center justify-center">
                                            <i class="fas fa-calendar-plus text-primary text-xl"></i>
                                        </div>
                                        <p class="text-gray-600 font-normal tracking-wide mb-4">No entries yet</p>
                                        <button onclick="toggleEntryForm()" class="bg-primary hover:bg-secondary text-white font-normal py-1 px-3 border-2 border-primary transition-all duration-200 tracking-wide text-xs">
                                            Add First Entry
                                        </button>
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Notes Section (50% of container width) -->
                        <div class="w-1/2 bg-white border-2 border-green-600 shadow-lg h-full flex flex-col">
                            <div class="border-b-2 border-green-600 bg-green-50 px-3 py-2 sm:px-6 sm:py-4 flex-shrink-0">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-lg sm:text-xl font-normal text-green-700 tracking-wide notes-header-text">Notes</h3>
                                    <div class="border-l-2 border-primary pl-3 flex items-center justify-center">
                                        <button onclick="toggleNotesForm()" class="bg-green-600 hover:bg-green-700 text-white font-normal px-3 py-2 border-2 border-green-600 transition-all duration-200 tracking-wide text-xs hover:shadow-lg flex items-center justify-center">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Notes Form -->
                            <div id="notesFormMobile" class="hidden border-b-2 border-green-600 bg-green-25 p-2 rounded-none" style="border-radius: 0;">
                                <form method="post" class="space-y-2">
                                    {% csrf_token %}
                                    <input type="hidden" name="add_note" value="1">
                                    
                                    <div>
                                        <label for="{{ note_form.title.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">Title</label>
                                        {{ note_form.title }}
                                    </div>
                                    
                                    <div>
                                        <label for="{{ note_form.child.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">Child</label>
                                        {{ note_form.child }}
                                    </div>
                                    
                                    <div>
                                        <label for="{{ note_form.category.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">Category (Optional)</label>
                                        {{ note_form.category }}
                                    </div>
                                    
                                    <div>
                                        <label for="{{ note_form.description.id_for_label }}" class="block text-xs font-medium text-gray-700 mb-1">Note</label>
                                        {{ note_form.description }}
                                    </div>
                                    
                                    {{ note_form.entry_type }}
                                    
                                    <div class="flex gap-1 pt-1">
                                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-normal py-1 px-2 border-2 border-green-600 transition-all duration-200 tracking-wide text-xs rounded-none" style="border-radius: 0;">
                                            Save Note
                                        </button>
                                        <button type="button" onclick="toggleNotesForm()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-normal py-1 px-2 border-2 border-gray-300 transition-all duration-200 tracking-wide text-xs rounded-none" style="border-radius: 0;">
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Notes Content -->
                            <div class="p-3 overflow-y-auto flex-1">
                                {% if notes %}
                                    <div class="space-y-2">
                                        {% for note in notes %}
                                            <div class="bg-green-50 border-l-4 border-green-600 p-3 hover:bg-green-100 transition-all duration-200" 
                                                 data-child-id="{{ note.child.id }}">
                                                <div class="flex justify-between items-start">
                                                    <div class="flex-1">
                                                        <h4 class="font-medium text-gray-900 text-sm">{{ note.title }}</h4>
                                                        <p class="text-gray-600 text-xs mt-1">{{ note.description|truncatewords:15 }}</p>
                                                        <div class="flex items-center gap-2 mt-2 text-xs text-gray-500">
                                                            <span class="bg-gray-100 px-2 py-1 border">{{ note.child.name }}</span>
                                                            <span>{{ note.created_at|date:"M d" }}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <div class="text-center py-12">
                                        <div class="w-16 h-16 mx-auto mb-4 bg-green-100 border-2 border-green-600 flex items-center justify-center">
                                            <i class="fas fa-sticky-note text-green-600 text-xl"></i>
                                        </div>
                                        <p class="text-gray-600 font-normal tracking-wide mb-4">No notes yet</p>
                                        <button onclick="toggleNotesForm()" class="bg-green-600 hover:bg-green-700 text-white font-normal py-1 px-3 border-2 border-green-600 transition-all duration-200 tracking-wide text-xs">
                                            Add First Note
                                        </button>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Desktop Layout: Three Columns (Child Page Structure) -->
            <div class="hidden md:grid md:grid-cols-12 gap-4 lg:gap-6 h-full">
                <!-- Left Column: Children Management (same width as child page) -->
                <div class="md:col-span-2 lg:col-span-2 xl:col-span-2 h-full">
                    <div class="bg-white border-2 border-primary shadow-lg h-full flex flex-col">
                        <div class="border-b-2 border-primary bg-gray-50 px-3 py-2 sm:px-6 sm:py-4">
                            <div class="flex items-center justify-between">
                                <h2 class="text-lg font-normal text-gray-900 tracking-wide">Your Children</h2>
                                <div class="border-l-2 border-primary pl-3 flex items-center justify-center">
                                    <button onclick="toggleChildForm()" class="bg-secondary hover:bg-purple-700 text-white font-normal px-4 py-3 border-2 border-secondary transition-all duration-200 tracking-wide text-sm hover:shadow-lg flex items-center justify-center">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Child Form -->
                        <div id="childFormDesktop" class="hidden border-b-2 border-secondary bg-purple-25 p-3 rounded-none" style="border-radius: 0;">
                            <form method="post" class="space-y-3">
                                {% csrf_token %}
                                <input type="hidden" name="add_child" value="1">
                                
                                <div>
                                    <label for="{{ child_form.name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                    {{ child_form.name }}
                                </div>
                                
                                <div>
                                    <label for="{{ child_form.birth_date.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ child_form.birth_date.label }}</label>
                                    {{ child_form.birth_date }}
                                    {% if child_form.birth_date.help_text %}
                                        <p class="text-xs text-gray-500 mt-1">{{ child_form.birth_date.help_text }}</p>
                                    {% endif %}
                                </div>
                                
                                <div>
                                    <label for="{{ child_form.school.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">School</label>
                                    {{ child_form.school }}
                                </div>
                                
                                <div>
                                    <label for="{{ child_form.year.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Year</label>
                                    {{ child_form.year }}
                                </div>
                                
                                <div>
                                    <label for="{{ child_form.class_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Class</label>
                                    {{ child_form.class_name }}
                                </div>
                                
                                <div>
                                    <label for="{{ child_form.colour.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Colour</label>
                                    <!-- Hidden select field -->
                                    {{ child_form.colour }}
                                    
                                    <!-- Custom color grid -->
                                    <div class="color-grid-widget rounded-none" data-target="{{ child_form.colour.id_for_label }}" style="border-radius: 0;">
                                        <div class="color-dots-grid">
                                            <div class="color-dot selected rounded-none" 
                                                 data-color="#FF6B6B"
                                                 onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                                 style="background-color: #FF6B6B; border-radius: 0;"
                                                 title="Coral Red">
                                            </div>
                                            <div class="color-dot rounded-none" 
                                                 data-color="#4ECDC4"
                                                 onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                                 style="background-color: #4ECDC4; border-radius: 0;"
                                                 title="Turquoise">
                                            </div>
                                            <div class="color-dot rounded-none" 
                                                 data-color="#0D6A80"
                                                 onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                                 style="background-color: #0D6A80; border-radius: 0;"
                                                 title="Sky Blue">
                                            </div>
                                            <div class="color-dot rounded-none" 
                                                 data-color="#96CEB4"
                                                 onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                                 style="background-color: #96CEB4; border-radius: 0;"
                                                 title="Mint Green">
                                            </div>
                                            <div class="color-dot rounded-none" 
                                                 data-color="#D1D811"
                                                 onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                                 style="background-color: #D1D811; border-radius: 0;"
                                                 title="Sunny Yellow">
                                            </div>
                                            <div class="color-dot rounded-none" 
                                                 data-color="#DDA0DD"
                                                 onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                                 style="background-color: #DDA0DD; border-radius: 0;"
                                                 title="Plum Purple">
                                            </div>
                                            <div class="color-dot rounded-none" 
                                                 data-color="#AD6A0D"
                                                 onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                                 style="background-color: #AD6A0D; border-radius: 0;"
                                                 title="Peach Orange">
                                            </div>
                                            <div class="color-dot rounded-none" 
                                                 data-color="#8516EE"
                                                 onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                                 style="background-color: #8516EE; border-radius: 0;"
                                                 title="Light Blue">
                                            </div>
                                            <div class="color-dot rounded-none" 
                                                 data-color="#0CEB0C"
                                                 onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                                 style="background-color: #0CEB0C; border-radius: 0;"
                                                 title="Pale Green">
                                            </div>
                                            <div class="color-dot rounded-none" 
                                                 data-color="#BE12E0"
                                                 onclick="selectColorDot(this, '{{ child_form.colour.id_for_label }}')"
                                                 style="background-color: #BE12E0; border-radius: 0;"
                                                 title="Bright Pink">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex gap-2">
                                    <button type="submit" class="bg-secondary hover:bg-purple-700 text-white font-normal py-1 px-3 border-2 border-secondary transition-all duration-200 tracking-wide text-sm rounded-none" style="border-radius: 0;">
                                        Add Child
                                    </button>
                                    <button type="button" onclick="toggleChildForm()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-normal py-1 px-3 border-2 border-gray-300 transition-all duration-200 tracking-wide text-sm rounded-none" style="border-radius: 0;">
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <div class="p-4 overflow-y-auto flex-1">
                            <div class="space-y-3">
                                <!-- All Children Button -->
                                <button onclick="showAllChildren()" 
                                        class="w-full border-2 border-gray-300 bg-white p-3 hover:bg-gray-50 transition-all duration-200 text-left">
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 border-2 border-primary bg-primary flex items-center justify-center text-white font-normal text-sm mr-3">
                                            <i class="fas fa-users"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-sm font-medium text-gray-900">All Children</h3>
                                            <p class="text-xs text-gray-600">{{ children_count }} children, {{ total_entries }} entries</p>
                                        </div>
                                    </div>
                                </button>
                                
                                <!-- Individual Children -->
                                {% for child in children %}
                                <div class="child-card border-2 border-gray-300 bg-white cursor-pointer hover:bg-gray-50 transition-all duration-200 relative" 
                                     data-child-id="{{ child.id }}" style="overflow: visible; z-index: 10;">
                                    <div class="p-3 flex items-center" onclick="toggleChildEdit({{ child.id }})">
                                        <div class="w-8 h-8 border-2 border-primary flex items-center justify-center text-white font-normal text-sm mr-3" 
                                             style="background-color: {{ child.colour }};">
                                            {{ child.name|first|upper }}
                                        </div>
                                        <div>
                                            <h3 class="text-sm font-medium text-gray-900">{{ child.name }}</h3>
                                            {% if child.school %}
                                                <p class="text-xs text-gray-600">{{ child.school }}</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <!-- Child Edit Form Dropdown -->
                                    <div id="childEdit{{ child.id }}Desktop" class="hidden border-t-2 border-secondary bg-purple-25 p-3 rounded-none" style="border-radius: 0;">
                                        <form method="post" action="{% url 'edit_child' child.id %}" class="space-y-3">
                                            {% csrf_token %}
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                                <input type="text" name="name" value="{{ child.name }}" 
                                                       class="w-full px-2 py-1 border-2 border-gray-300 focus:border-secondary focus:outline-none text-sm rounded-none" style="border-radius: 0;">
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Date of Birth</label>
                                                <input type="date" name="birth_date" value="{{ child.birth_date|date:'Y-m-d' }}" 
                                                       class="w-full px-2 py-1 border-2 border-gray-300 focus:border-secondary focus:outline-none text-sm rounded-none" style="border-radius: 0;">
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">School</label>
                                                <input type="text" name="school" value="{{ child.school|default:'' }}" 
                                                       class="w-full px-2 py-1 border-2 border-gray-300 focus:border-secondary focus:outline-none text-sm rounded-none" style="border-radius: 0;">
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Year</label>
                                                <input type="text" name="year" value="{{ child.year|default:'' }}" 
                                                       class="w-full px-2 py-1 border-2 border-gray-300 focus:border-secondary focus:outline-none text-sm rounded-none" style="border-radius: 0;">
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Class</label>
                                                <input type="text" name="class_name" value="{{ child.class_name|default:'' }}" 
                                                       class="w-full px-2 py-1 border-2 border-gray-300 focus:border-secondary focus:outline-none text-sm rounded-none" style="border-radius: 0;">
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Color</label>
                                                <div class="flex gap-1 flex-wrap">
                                                    <div class="color-dot-small w-5 h-5 border-2 cursor-pointer rounded-none {{ child.colour|yesno:'selected,' }}" 
                                                         data-color="#FF6B6B" style="background-color: #FF6B6B; border-radius: 0;" 
                                                         onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                    <div class="color-dot-small w-5 h-5 border-2 cursor-pointer rounded-none" 
                                                         data-color="#4ECDC4" style="background-color: #4ECDC4; border-radius: 0;" 
                                                         onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                    <div class="color-dot-small w-5 h-5 border-2 cursor-pointer rounded-none" 
                                                         data-color="#0D6A80" style="background-color: #0D6A80; border-radius: 0;" 
                                                         onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                    <div class="color-dot-small w-5 h-5 border-2 cursor-pointer rounded-none" 
                                                         data-color="#96CEB4" style="background-color: #96CEB4; border-radius: 0;" 
                                                         onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                    <div class="color-dot-small w-5 h-5 border-2 cursor-pointer rounded-none" 
                                                         data-color="#D1D811" style="background-color: #D1D811; border-radius: 0;" 
                                                         onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                    <div class="color-dot-small w-5 h-5 border-2 cursor-pointer rounded-none" 
                                                         data-color="#DDA0DD" style="background-color: #DDA0DD; border-radius: 0;" 
                                                         onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                    <div class="color-dot-small w-5 h-5 border-2 cursor-pointer rounded-none" 
                                                         data-color="#AD6A0D" style="background-color: #AD6A0D; border-radius: 0;" 
                                                         onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                    <div class="color-dot-small w-5 h-5 border-2 cursor-pointer rounded-none" 
                                                         data-color="#8516EE" style="background-color: #8516EE; border-radius: 0;" 
                                                         onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                    <div class="color-dot-small w-5 h-5 border-2 cursor-pointer rounded-none" 
                                                         data-color="#0CEB0C" style="background-color: #0CEB0C; border-radius: 0;" 
                                                         onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                    <div class="color-dot-small w-5 h-5 border-2 cursor-pointer rounded-none" 
                                                         data-color="#BE12E0" style="background-color: #BE12E0; border-radius: 0;" 
                                                         onclick="selectChildColor(this, '{{ child.id }}')"></div>
                                                </div>
                                                <input type="hidden" name="colour" value="{{ child.colour }}" id="childColor{{ child.id }}">
                                            </div>
                                            
                                            <div class="flex gap-2">
                                                <button type="submit" class="bg-secondary hover:bg-purple-700 text-white font-normal py-1 px-3 border-2 border-secondary transition-all duration-200 tracking-wide text-sm rounded-none" style="border-radius: 0;">
                                                    Save Changes
                                                </button>
                                                <button type="button" onclick="toggleChildEdit({{ child.id }})" class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-normal py-1 px-3 border-2 border-gray-300 transition-all duration-200 tracking-wide text-sm rounded-none" style="border-radius: 0;">
                                                    Cancel
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Middle Column: Timeline (same width as child page) -->
                <div class="md:col-span-6 lg:col-span-6 xl:col-span-6 h-full">
                    <div class="bg-white border-2 border-primary shadow-lg h-full flex flex-col">
                        <div class="border-b-2 border-primary bg-gray-50 px-3 py-2 sm:px-6 sm:py-4 flex-shrink-0">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-normal text-gray-900 tracking-wide child-header-text">Tasks & Events</h3>
                                <div class="flex items-center gap-2">
                                    <nav class="flex gap-2">
                                        <a href="?type=" class="py-2 px-4 border-2 font-normal text-sm tracking-wide transition-all duration-200 {% if not request.GET.type %}bg-primary text-white border-primary{% else %}bg-white text-gray-700 border-gray-300 hover:border-primary hover:text-primary{% endif %}">
                                            All
                                        </a>
                                        <a href="?type=task" class="py-2 px-4 border-2 font-normal text-sm tracking-wide transition-all duration-200 {% if request.GET.type == 'task' %}bg-amber-600 text-white border-amber-600{% else %}bg-white text-gray-700 border-gray-300 hover:border-amber-600 hover:text-amber-600{% endif %}">
                                            Tasks
                                        </a>
                                        <a href="?type=event" class="py-2 px-4 border-2 font-normal text-sm tracking-wide transition-all duration-200 {% if request.GET.type == 'event' %}bg-violet-600 text-white border-violet-600{% else %}bg-white text-gray-700 border-gray-300 hover:border-violet-600 hover:text-violet-600{% endif %}">
                                            Events
                                        </a>
                                    </nav>
                                    <div class="border-l-2 border-primary pl-3 flex items-center justify-center">
                                        <button onclick="toggleEntryForm()" class="bg-primary hover:bg-secondary text-white font-normal px-4 py-3 border-2 border-primary transition-all duration-200 tracking-wide text-sm hover:shadow-lg flex items-center justify-center">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Entry Form -->
                        <div id="entryFormDesktop" class="hidden border-b-2 border-primary bg-gray-25 p-3 rounded-none" style="border-radius: 0;">
                            <form method="post" class="space-y-3">
                                {% csrf_token %}
                                <input type="hidden" name="add_entry" value="1">
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <div>
                                        <label for="{{ form.title.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                                        {{ form.title }}
                                    </div>
                                    
                                    <div>
                                        <label for="{{ form.entry_type.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                        {{ form.entry_type }}
                                    </div>
                                    
                                    <div>
                                        <label for="{{ form.child.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Child</label>
                                        {{ form.child }}
                                    </div>
                                    
                                    <div>
                                        <label for="{{ form.category.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                        {{ form.category }}
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="{{ form.description.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                    {{ form.description }}
                                </div>
                                
                                <div class="flex gap-2">
                                    <button type="submit" class="bg-primary hover:bg-secondary text-white font-normal py-1 px-3 border-2 border-primary transition-all duration-200 tracking-wide text-sm rounded-none" style="border-radius: 0;">
                                        Save Entry
                                    </button>
                                    <button type="button" onclick="toggleEntryForm()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-normal py-1 px-3 border-2 border-gray-300 transition-all duration-200 tracking-wide text-sm rounded-none" style="border-radius: 0;">
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Timeline Content -->
                        <div class="p-4 overflow-y-auto flex-1">
                            {% if active_entries %}
                                <div class="space-y-4">
                                    {% for entry in active_entries %}
                                        <div class="{% if entry.entry_type == 'task' %}bg-amber-50 border-l-4 border-amber-600{% elif entry.entry_type == 'event' %}bg-violet-50 border-l-4 border-violet-600{% endif %} p-4 hover:bg-opacity-80 transition-all duration-200" 
                                             data-child-id="{{ entry.child.id }}">
                                            <div class="flex justify-between items-start">
                                                <div class="flex-1">
                                                    <h4 class="font-medium text-gray-900">{{ entry.title }}</h4>
                                                    <p class="text-gray-600 text-sm mt-1">{{ entry.description|truncatewords:20 }}</p>
                                                    <div class="flex items-center gap-4 mt-2 text-sm text-gray-500">
                                                        <span class="bg-gray-100 px-2 py-1 border">{{ entry.child.name }}</span>
                                                        <span>{{ entry.created_at|date:"M d, Y" }}</span>
                                                        {% if entry.due_date %}
                                                            <span>Due: {{ entry.due_date|date:"M d" }}</span>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <a href="{% url 'edit_entry' entry.id %}" class="text-gray-400 hover:text-primary transition-colors duration-200 ml-4">
                                                    <i class="fas fa-pencil-alt"></i>
                                                </a>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="text-center py-12">
                                    <div class="w-16 h-16 mx-auto mb-4 bg-gray-100 border-2 border-primary flex items-center justify-center">
                                        <i class="fas fa-calendar-plus text-primary text-xl"></i>
                                    </div>
                                    <p class="text-gray-600 font-normal tracking-wide mb-4">No entries yet</p>
                                    <button onclick="toggleEntryForm()" class="bg-primary hover:bg-secondary text-white font-normal py-2 px-4 border-2 border-primary transition-all duration-200 tracking-wide hover:shadow-lg">
                                        Add First Entry
                                    </button>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Right Column: Notes (same width as child page) -->
                <div class="md:col-span-4 lg:col-span-4 xl:col-span-4 h-full">
                    <div class="bg-white border-2 border-green-600 shadow-lg h-full flex flex-col">
                        <div class="border-b-2 border-green-600 bg-green-50 px-3 py-2 sm:px-6 sm:py-4 flex-shrink-0">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-normal text-green-700 tracking-wide notes-header-text">Notes</h3>
                                <div class="border-l-2 border-primary pl-3 flex items-center justify-center">
                                    <button onclick="toggleNotesForm()" class="bg-green-600 hover:bg-green-700 text-white font-normal px-4 py-3 border-2 border-green-600 transition-all duration-200 tracking-wide text-sm hover:shadow-lg flex items-center justify-center">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Notes Form -->
                        <div id="notesFormDesktop" class="hidden border-b-2 border-green-600 bg-green-25 p-3 rounded-none" style="border-radius: 0;">
                            <form method="post" class="space-y-3">
                                {% csrf_token %}
                                <input type="hidden" name="add_note" value="1">
                                
                                <div>
                                    <label for="{{ note_form.title.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                                    {{ note_form.title }}
                                </div>
                                
                                <div>
                                    <label for="{{ note_form.child.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Child</label>
                                    {{ note_form.child }}
                                </div>
                                
                                <div>
                                    <label for="{{ note_form.category.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Category (Optional)</label>
                                    {{ note_form.category }}
                                </div>
                                
                                <div>
                                    <label for="{{ note_form.description.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Note</label>
                                    {{ note_form.description }}
                                </div>
                                
                                {{ note_form.entry_type }}
                                
                                <div class="flex gap-2">
                                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-normal py-1 px-3 border-2 border-green-600 transition-all duration-200 tracking-wide text-sm rounded-none" style="border-radius: 0;">
                                        Save Note
                                    </button>
                                    <button type="button" onclick="toggleNotesForm()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-normal py-1 px-3 border-2 border-gray-300 transition-all duration-200 tracking-wide text-sm rounded-none" style="border-radius: 0;">
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Notes Content -->
                        <div class="p-4 overflow-y-auto flex-1">
                            {% if notes %}
                                <div class="space-y-4">
                                    {% for note in notes %}
                                        <div class="bg-green-50 border-l-4 border-green-600 p-4 hover:bg-green-100 transition-all duration-200" 
                                             data-child-id="{{ note.child.id }}">
                                            <div class="flex justify-between items-start">
                                                <div class="flex-1">
                                                    <h4 class="font-medium text-gray-900">{{ note.title }}</h4>
                                                    <p class="text-gray-600 text-sm mt-1">{{ note.description|truncatewords:20 }}</p>
                                                    <div class="flex items-center gap-4 mt-2 text-sm text-gray-500">
                                                        <span class="bg-gray-100 px-2 py-1 border">{{ note.child.name }}</span>
                                                        <span>{{ note.created_at|date:"M d, Y" }}</span>
                                                    </div>
                                                </div>
                                                <a href="{% url 'edit_entry' note.id %}" class="text-gray-400 hover:text-green-600 transition-colors duration-200 ml-4">
                                                    <i class="fas fa-pencil-alt"></i>
                                                </a>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="text-center py-12">
                                    <div class="w-16 h-16 mx-auto mb-4 bg-green-100 border-2 border-green-600 flex items-center justify-center">
                                        <i class="fas fa-sticky-note text-green-600 text-xl"></i>
                                    </div>
                                    <p class="text-gray-600 font-normal tracking-wide mb-4">No notes yet</p>
                                    <button onclick="toggleNotesForm()" class="bg-green-600 hover:bg-green-700 text-white font-normal py-2 px-4 border-2 border-green-600 transition-all duration-200 tracking-wide hover:shadow-lg">
                                        Add First Note
                                    </button>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}