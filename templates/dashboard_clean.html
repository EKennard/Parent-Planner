<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <nav>
        <div>
            <div>
                <div>
                    <h1>ParentPlanner</h1>
                </div>
                <div>
                    <span>
                        {{ parent.user.first_name|default:parent.user.username }}
                    </span>
                    <a href="{% url 'logout' %}">Logout</a>
                </div>
            </div>
        </div>
    </nav>

    <div>
        {% csrf_token %}
        {% if messages %}
            {% for message in messages %}
            <div>
                {% if message.tags == 'success' %}
                {% elif message.tags == 'error' %}
                {% else %}
                {% endif %}
                <span>{{ message }}</span>
            </div>
            {% endfor %}
        {% endif %}
    </div>

    <div>
        <p>Total</p>
        <h3>{{total_entries }}</h3>
    </div>

    <div>
        <p>Notes</p>
        <h3>{{notes_count }}</h3>
    </div>

    <div>
        <p>Tasks</p>
        <h3>{{tasks_count }}</h3>
    </div>

    <div>
        <p>Events</p>
        <h3>{{ events_count }}</h3>
    </div>

    <!-- family management section -->
    <div>
        <div>
            <div>
                <div>
                    <h2>Family Management</h2>
                    <p>Organize children and activities</p>
                </div>
                <div>
                    <a href="{% url 'add_entry' %}">Add Entry</a>
                    <a href="{% url 'add_child' %}">Add Child</a>
                </div>
            </div>
        </div>

        <!-- child container -->
        <div>
            {% if children %}
            <div>
                {% for child in children %}
                <div>
                    <!-- Child header -->
                    <div>
                        <div>
                            <div>
                                <div>
                                    {{ child.name|first|upper }}
                                </div>
                            </div>
                            <div>
                                <h3>{{ child.name }}</h3>
                                {% if child.school %}
                                <p>{{ child.school }}</p>
                                {% endif %}
                                {% if child.year %}
                                <p>{{ child.year }}{% if child.class_name %} - {{ child.class_name }}{% endif %}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- buttons -->
                    <div>
                        <a href="{% url 'child_entries' child.id %}">View Entries</a>
                        <a href="{% url 'edit_child' child.id %}">Edit Profile</a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div>
                <h3>Start Family Planning</h3>
                <p>Add your first child to begin organizing family activities</p>
                <a href="{% url 'add_child' %}">Add Your First Child</a>
            </div>
            {% endif %}
        </div>

        <!-- timeline section -->
        <div>
            <div>
                <div>
                    <div>
                        <div>
                            <h2>Active Timeline</h2>
                        </div>
                        <span>Chronological entries</span>
                    </div>
                </div>

                <div>
                    {% if active_entries %}
                    <div>
                        {% for entry in active_entries|slice:":10" %}
                        <div>
                            <!-- content -->
                            <div>
                                <div>
                                    <div>
                                        <div>
                                            <h3>{{ entry.title }}</h3>
                                            {% if entry.is_completed %}
                                            <span>Done</span>
                                            {% endif %}
                                        </div>

                                        <div>
                                            <span>{{ entry.get_entry_type_display}}</span>
                                            {% if entry.category %}
                                            <span>{{ entry.category.name }}</span>
                                            {% endif %}
                                            {% if entry.priority and entry.entry_type == 'task' %}
                                            <span>{{ entry.get_priority_display }}</span>
                                            {% endif %}
                                        </div>

                                        <!-- Date/Time info -->
                                        <div>
                                            {% if entry.entry_type == 'task' and entry.due_date %}
                                            <span>Due: {{ entry.due_date|date:"M d, Y g:i A" }}</span>
                                            {% elif entry.entry_type == 'event' and entry.start_time %}
                                            <span>
                                                {{ entry.start_time|date:"M d, Y g:i A" }}
                                                {% if entry.end_time %} - {{ entry.end_time|date:"g:i A" }}{% endif %}
                                            </span>
                                            {% if entry.location %}
                                            <span>{{ entry.location }}</span>
                                            {% endif %}
                                            {% else %}
                                            <span>Created: {{ entry.created_at|date:"M d, Y g:i A" }}</span>
                                            {% endif %}
                                        </div>

                                        {% if entry.description %}
                                        <p>{{ entry.description|truncatewords:15 }}</p>
                                        {% endif %}
                                    </div>

                                    <!-- buttons -->
                                    <div>
                                        {% if entry.entry_type == 'task' or entry.entry_type == 'event' %}
                                        <a href="{% url 'toggle_entry_completion' entry.id %}" 
                                           title="{% if entry.is_completed %}Mark incomplete{% else %}Mark complete{% endif %}">
                                            {% if entry.is_completed %}Undo{% else %}Done{% endif %}
                                        </a>
                                        {% endif %}

                                        <a href="{% url 'edit_entry' entry.id %}">Edit</a>

                                        <a href="{% url 'child_entries' entry.child.id %}" title="View all for {{ entry.child.name }}">All</a>

                                        <a href="{% url 'quick_delete_entry' entry.id %}" 
                                           onclick="confirmDelete('{{ entry.title }}', this.href); return false;" 
                                           title="Delete entry">Delete</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- show more section -->
                    {% if active_entries|length > 10 %}
                    <div>
                        <p>Showing first 10 entries</p>
                        <a href="{% url 'add_entry' %}">Add New Entry</a>
                    </div>
                    {% endif %}
                    {% else %}
                    <div>
                        <h3>No entries yet</h3>
                        <p>Start by adding notes, tasks, or events</p>
                        <a href="{% url 'add_entry' %}">Add First Entry</a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <script>
        function confirmDelete(entryTitle, deleteUrl) {
            if (confirm(`Are you sure you want to delete "${entryTitle}"? This action cannot be undone.`)) {
                // Create a form and submit it for POST request
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = deleteUrl;

                // Add CSRF token
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
                if (csrfToken) {
                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = 'csrfmiddlewaretoken';
                    csrfInput.value = csrfToken.value;
                    form.appendChild(csrfInput);
                }

                document.body.appendChild(form);
                form.submit();
            }
        }

        // Add smooth scrolling to any anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        })
    </script>
</body>

</html>
